<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonslan - Tactical Command V28.6 (Pro Insight)</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617;
            --card-bg: rgba(15, 23, 42, 0.85);
            --neon-pink: #ff007a;
            --neon-blue: #00f2ff;
            --neon-green: #10b981;
            --neon-yellow: #f59e0b;
            --text: #f1f5f9;
            --border: rgba(0, 242, 255, 0.2);
            --zoom-level: 1;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 10px; }

        * { box-sizing: border-box; transition: transform 0.2s ease; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 242, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(255, 0, 122, 0.1) 0%, transparent 40%);
            color: var(--text); margin: 0; padding: 15px; min-height: 100vh; overflow-x: hidden;
        }

        #master-wrapper {
            transform-origin: top center;
            transform: scale(var(--zoom-level));
        }

        .zoom-controls {
            position: fixed; bottom: 20px; right: 20px; z-index: 10000;
            display: flex; gap: 10px; background: rgba(0,0,0,0.7); padding: 8px; border-radius: 50px; border: 1px solid var(--border);
        }

        .dashboard {
            max-width: 1800px; margin: 0 auto;
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
        }

        .card { 
            background: var(--card-bg); border-radius: 20px; padding: 20px; 
            border: 1px solid var(--border); backdrop-filter: blur(25px);
            position: relative; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-pink));
        }

        .center-command { display: flex; flex-direction: column; gap: 20px; }

        .main-clock-section { text-align: center; padding: 20px; }

        .central-countdown {
            display: grid; grid-template-columns: 1fr 1fr; gap: 40px;
            margin: 20px 0; padding: 20px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border);
            background: rgba(255,255,255,0.02); border-radius: 20px;
        }

        .title-h2 { 
            font-family: 'Orbitron'; font-size: 0.75rem; color: var(--neon-blue); 
            margin-bottom: 15px; letter-spacing: 2px; text-transform: uppercase; 
            display: flex; align-items: center; gap: 10px;
        }
        .title-h2 span { color: var(--neon-pink); font-weight: 900; }

        #tactical-search {
            width: 100%; padding: 18px 30px; background: rgba(0,0,0,0.5);
            border: 1px solid var(--border); border-radius: 100px; color: white;
            font-family: 'JetBrains Mono'; outline: none; font-size: 1rem;
            margin-bottom: 10px; transition: 0.3s;
        }
        #tactical-search:focus { border-color: var(--neon-pink); box-shadow: 0 0 20px rgba(255, 0, 122, 0.2); }

        .timer-display { font-family: 'JetBrains Mono'; font-weight: 800; line-height: 1; letter-spacing: -2px; }
        .big-time { font-size: 5.5rem; color: #fff; text-shadow: 0 0 30px rgba(0, 242, 255, 0.4); }
        
        .todo-item { 
            display: flex; align-items: center; gap: 12px; padding: 12px; 
            background: rgba(255,255,255,0.04); border-radius: 12px; margin-bottom: 8px; cursor: pointer;
            font-size: 0.85rem; border: 1px solid transparent; transition: 0.2s;
        }
        .todo-item:hover { border-color: var(--neon-blue); transform: translateX(5px); }
        .todo-item.done { opacity: 0.4; text-decoration: line-through; filter: grayscale(1); }

        .btn { 
            background: rgba(0, 242, 255, 0.1); border: 1px solid var(--neon-blue); color: white;
            padding: 10px 18px; border-radius: 10px; font-family: 'Orbitron'; font-size: 0.65rem; cursor: pointer;
            font-weight: bold; text-transform: uppercase; transition: 0.3s;
        }
        .btn:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); }

        .target-input {
            background: transparent; border: none; color: var(--neon-blue); text-align: right; outline: none; width: 80px; font-family: 'JetBrains Mono'; font-weight: bold; border-bottom: 1px solid transparent;
        }
        .target-input:focus { border-bottom: 1px solid var(--neon-pink); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .link-card {
            background: rgba(0,0,0,0.3); padding: 12px; border-radius: 12px; text-decoration: none; color: var(--text); font-size: 0.75rem; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 10px;
        }
        .link-card:hover { border-color: var(--neon-pink); background: rgba(255,0,122,0.1); }

        /* VIDEO SYSTEM */
        .video-container {
            width: 100%; border-radius: 12px; overflow: hidden; border: 1px solid var(--neon-pink); 
            margin-bottom: 10px; position: relative; background: #000; aspect-ratio: 16/9;
        }
        #main-video { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        .video-overlay {
            position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.3); cursor: pointer; opacity: 0; transition: 0.3s;
        }
        .video-container:hover .video-overlay { opacity: 1; }
        .play-btn { font-size: 3rem; color: white; filter: drop-shadow(0 0 10px var(--neon-blue)); }
        .video-nav { display: flex; gap: 5px; margin-bottom: 15px; }
        .video-tag { position: absolute; top: 10px; right: 10px; background: var(--neon-pink); padding: 2px 8px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 0.6rem; z-index: 10; }

        /* THEATER MODE */
        #theater-mode {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 20000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        #theater-mode.active { display: flex; }
        #theater-video { width: 80vw; max-height: 80vh; border: 2px solid var(--neon-blue); box-shadow: 0 0 50px rgba(0,242,255,0.3); }

        /* STATS ANALYTICS */
        .stats-scroll { max-height: 150px; overflow-y: auto; padding-right: 5px; margin-top: 10px; }
        .stats-table { width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono'; }
        .stats-table td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.75rem; }
        .label-dim { opacity: 0.6; text-transform: uppercase; font-size: 0.6rem; }
        .value-neon { color: var(--neon-blue); font-weight: bold; text-align: right; }

        .focus-overlay {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        body.focus-active { overflow: hidden; }
        body.focus-active .focus-overlay { display: flex; }

        @media (max-width: 1400px) { .dashboard { grid-template-columns: 300px 1fr; } .sidebar-right { grid-column: 1 / -1; display: grid; grid-template-columns: 1fr 1fr 1fr; } }
        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } .sidebar-right { grid-template-columns: 1fr; } }
    </style>
</head>
<body id="main-body">

<div class="zoom-controls">
    <button class="btn" onclick="adjustZoom(0.1)">+</button>
    <button class="btn" onclick="resetZoom()">1:1</button>
    <button class="btn" onclick="adjustZoom(-0.1)">-</button>
</div>

<div id="theater-mode">
    <video id="theater-video" controls loop></video>
    <div style="margin-top: 20px; display: flex; gap: 20px;">
        <button class="btn" onclick="prevVideo()">BACK</button>
        <button class="btn" onclick="closeTheater()" style="border-color: var(--neon-pink);">CLOSE (ESC)</button>
        <button class="btn" onclick="nextVideo()">NEXT</button>
    </div>
</div>

<div class="focus-overlay" id="focus-zone" onclick="toggleFocus(false)">
    <div id="focus-timer-big" class="timer-display" style="font-size: 12rem; color: var(--neon-blue);">00:00:00</div>
    <div id="focus-mode-label" style="font-family: 'Orbitron'; letter-spacing: 15px; color: var(--neon-pink); margin-top: 30px; text-align:center;">DEEP WORK MODE</div>
    <div style="margin-top: 50px; opacity: 0.4; font-size: 0.8rem;">CLICK ANYWHERE TO EXIT</div>
</div>

<div id="master-wrapper">
<div class="dashboard">
    <div class="sidebar-left">
        <div class="card" style="margin-bottom: 20px;">
            <h2 class="title-h2"><span>01</span> VISUAL MOTIVATION</h2>
            <div class="video-container" onclick="openTheater()">
                <div class="video-tag" id="video-info">VIDEO LOADING...</div>
                <video id="main-video" autoplay muted loop playsinline></video>
                <div class="video-overlay"><span class="play-btn">‚ñ∂</span></div>
            </div>
            <div class="video-nav">
                <button class="btn" onclick="prevVideo()" style="flex:1">BACK</button>
                <button class="btn" onclick="nextVideo()" style="flex:1">NEXT</button>
            </div>
            <div id="subject-log" class="grid-2"></div>
        </div>

        <div class="card" style="margin-bottom: 20px;">
            <h2 class="title-h2"><span>02</span> SCRATCHPAD</h2>
            <textarea id="scratchpad" placeholder="√ù t∆∞·ªüng nhanh..." 
                style="width: 100%; height: 120px; background: rgba(0,0,0,0.3); border: none; color: #fff; font-family: 'Inter'; font-size: 0.85rem; padding: 15px; border-radius: 12px; resize: none; border: 1px solid rgba(255,255,255,0.05); outline:none;"></textarea>
        </div>

        <div class="card">
            <h2 class="title-h2"><span>03</span> TH√ÅNG HI·ªÜN T·∫†I</h2>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <button onclick="changeMonth(-1)" class="btn"><</button>
                <div id="cal-title" style="font-family: 'Orbitron'; font-size: 0.8rem; color: var(--neon-blue);"></div>
                <button onclick="changeMonth(1)" class="btn">></button>
            </div>
            <div id="cal-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;"></div>
            <div style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; font-size: 0.6rem; margin-bottom: 8px; letter-spacing:1px;">
                    <span>COMPLETION RATE</span><span id="month-pc">0%</span>
                </div>
                <div style="height: 4px; background: #000; border-radius: 10px; overflow: hidden;">
                    <div id="month-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue)); transition: 1s;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="center-command">
        <div class="search-container">
            <input type="text" id="tactical-search" placeholder="Search Google or enter URL (Press Enter)...">
        </div>

        <div class="main-clock-section">
            <div id="sys-date" style="font-family: 'Orbitron'; color: var(--neon-pink); letter-spacing: 5px; font-size: 0.9rem; margin-bottom: 10px; opacity: 0.8;">---</div>
            <div id="main-clock" class="timer-display big-time">00:00:00</div>
            
            <div class="central-countdown">
                <div>
                    <div style="color: var(--neon-pink); font-size: 0.7rem; font-family: 'Orbitron'; letter-spacing: 2px;">TN THPT 2026</div>
                    <div id="tn-d-center" style="font-size: 3.5rem; font-family: 'Orbitron'; font-weight: 900; color: #fff;">--</div>
                    <div style="font-size: 0.55rem; opacity: 0.5; letter-spacing: 3px;">DAYS REMAINING</div>
                </div>
                <div style="border-left: 1px solid var(--border);">
                    <div style="color: var(--neon-blue); font-size: 0.7rem; font-family: 'Orbitron'; letter-spacing: 2px;">HSA VNU 2026</div>
                    <div id="hsa-d-center" style="font-size: 3.5rem; font-family: 'Orbitron'; font-weight: 900; color: #fff;">--</div>
                    <div style="font-size: 0.55rem; opacity: 0.5; letter-spacing: 3px;">DAYS REMAINING</div>
                </div>
            </div>

            <h1 id="quote-display" onclick="editQuote()" style="cursor: pointer; font-family: 'Orbitron'; font-size: 1.4rem; margin: 15px 0; color: #fff; text-transform: uppercase; letter-spacing: 5px; transition: 0.3s;">K·ª∂ LU·∫¨T L√Ä S·ª®C M·∫†NH</h1>
        </div>

        <div class="card">
            <h2 class="title-h2"><span>04</span> B·ªò ƒê·∫æM CHI·∫æN THU·∫¨T & D·ªÆ LI·ªÜU</h2>
            <div class="grid-2" style="gap: 30px; margin-bottom: 20px;">
                <div style="text-align: center;">
                    <div class="title-h2" style="justify-content: center;">STOPWATCH</div>
                    <div id="sw-display" class="timer-display" style="color: var(--neon-green); font-size: 3.2rem; margin-bottom: 15px;">00:00:00</div>
                    <div style="display: flex; gap: 8px; justify-content: center;">
                        <button class="btn" id="sw-start-btn" onclick="toggleSW()">B·∫ÆT ƒê·∫¶U</button>
                        <button class="btn" onclick="saveStudyLog()" style="border-color: var(--neon-pink);">L∆ØU L·∫†I</button>
                    </div>
                </div>
                <div style="border-left: 1px solid rgba(255,255,255,0.1); padding-left: 20px;">
                    <div class="title-h2" style="justify-content: center;">STUDY ANALYTICS</div>
                    <div class="stats-scroll">
                        <table class="stats-table">
                            <thead>
                                <tr><td class="label-dim">Ng√†y</td><td class="label-dim" style="text-align:right">Th·ªùi gian</td></tr>
                            </thead>
                            <tbody id="stats-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="grid-2" style="gap:30px; border-top: 1px solid var(--border); padding-top: 20px;">
                <div style="text-align: center;">
                    <div class="title-h2" style="justify-content: center;">POMODORO</div>
                    <div id="tm-display" class="timer-display" style="color: var(--neon-yellow); font-size: 3.2rem; margin-bottom: 15px;">25:00</div>
                    <div style="display: flex; gap: 8px; justify-content: center; align-items: center;">
                        <input type="number" id="tm-min" value="25" style="width: 50px; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; padding: 5px; border-radius: 8px; text-align: center;">
                        <button class="btn" id="tm-start-btn" onclick="toggleTM()">CH·∫†Y</button>
                        <button class="btn" onclick="resetTM()">‚Üª</button>
                    </div>
                </div>
                <div style="display:flex; align-items:center; justify-content:center;">
                     <div class="btn" style="width: 100%; text-align: center; padding: 25px;" onclick="toggleFocus(true)">K√çCH HO·∫†T FOCUS MODE</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="title-h2"><span>05</span> L·ªò TR√åNH √îN THI</h2>
            <div id="roadmap-list" style="max-height: 220px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;"></div>
        </div>
    </div>

    <div class="sidebar-right">
        <div class="card" style="margin-bottom: 20px;">
            <h2 class="title-h2"><span>06</span> TARGET SCORE</h2>
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; font-family:'JetBrains Mono'; font-size: 0.8rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span>ƒêI·ªÇM HSA:</span><input type="text" id="target-hsa" class="target-input" value="100+">
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span>TO√ÅN:</span><input type="text" id="target-math" class="target-input" value="9.0">
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                    <span>V·∫¨T L√ù:</span><input type="text" id="target-physics" class="target-input" value="9.0">
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>TIN H·ªåC:</span><input type="text" id="target-it" class="target-input" value="9.0">
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 20px;">
            <h2 class="title-h2"><span>07</span> NHI·ªÜM V·ª§ CHI·∫æN THU·∫¨T</h2>
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <input type="text" id="todo-input" placeholder="Add mission..." style="flex:1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; color: white; padding: 10px; font-size: 0.8rem;">
                <button onclick="addTodo()" class="btn">+</button>
            </div>
            <div id="todo-list" style="max-height: 280px; overflow-y: auto;"></div>
        </div>

        <div class="card">
            <h2 class="title-h2"><span>08</span> EXTERNAL LINKS</h2>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <a href="https://docs.google.com/spreadsheets/d/18qov1FzYTm6A-yswR8RNXB17BanuLmX5dppUzv3vlF8/edit?gid=0#gid=0" target="_blank" class="link-card" style="border-color: var(--neon-pink);"><i>üìä</i> <b>HSA SHEET</b></a>
                <a href="https://khaothi.vnu.edu.vn" target="_blank" class="link-card"><i>üîµ</i> HSA VNU Portal</a>
                <a href="https://mapstudy.edu.vn" target="_blank" class="link-card"><i>üìö</i> MapStudy</a>
                <a href="https://tenschool.vn" target="_blank" class="link-card"><i>üî¢</i> TenSchool</a>
                <a href="https://chatgpt.com" target="_blank" class="link-card"><i>ü§ñ</i> AI Assistant</a>
            </div>
        </div>
    </div>
</div>
</div>

<audio id="alarm-sound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>

<script>
    // --- DATABASE MANAGER ---
    const DB_KEY = 'MOONSLAN_V28_';
    const db = {
        save: (k, v) => localStorage.setItem(DB_KEY + k, JSON.stringify(v)),
        get: (k, def = null) => {
            const val = localStorage.getItem(DB_KEY + k);
            try { return val ? JSON.parse(val) : def; } catch { return def; }
        }
    };

    // --- VIDEO SYSTEM (AUTO FROM GITHUB) ---
    const playlist = ["1.mp4", "2.mp4", "3.mp4", "4.mp4", "5.mp4", "6.mp4", "7.mp4", "8.mp4", "9.mp4", "10.mp4", "11.mp4", "12.mp4", "13.mp4"];
    let vIdx = 0;
    function updateVideo() {
        const v = document.getElementById('main-video'), tv = document.getElementById('theater-video');
        const info = document.getElementById('video-info');
        v.src = playlist[vIdx]; tv.src = playlist[vIdx];
        info.innerText = `TRACK ${vIdx + 1}/${playlist.length}`;
        v.play().catch(() => console.log("User interaction required"));
        if (document.getElementById('theater-mode').classList.contains('active')) tv.play();
    }
    function nextVideo() { vIdx = (vIdx + 1) % playlist.length; updateVideo(); }
    function prevVideo() { vIdx = (vIdx - 1 + playlist.length) % playlist.length; updateVideo(); }
    function openTheater() { document.getElementById('theater-mode').classList.add('active'); document.getElementById('theater-video').play(); }
    function closeTheater() { document.getElementById('theater-mode').classList.remove('active'); document.getElementById('theater-video').pause(); }

    // --- STOPWATCH & POMODORO ---
    let swActive = false, swInterval = null, swStartTime = 0, swBaseTime = db.get('sw_base', 0);
    function toggleSW() {
        const btn = document.getElementById('sw-start-btn');
        if (!swActive) {
            swActive = true; swStartTime = Date.now();
            swInterval = setInterval(updateSWDisplay, 100);
            btn.innerText = "D·ª™NG"; btn.style.borderColor = "var(--neon-yellow)";
        } else {
            swActive = false; clearInterval(swInterval);
            swBaseTime += (Date.now() - swStartTime);
            db.save('sw_base', swBaseTime);
            btn.innerText = "TI·∫æP T·ª§C"; btn.style.borderColor = "var(--neon-blue)";
        }
    }
    function formatTime(s) {
        const h = Math.floor(s / 3600).toString().padStart(2, '0');
        const m = Math.floor((s % 3600) / 60).toString().padStart(2, '0');
        const sec = (s % 60).toString().padStart(2, '0');
        return `${h}:${m}:${sec}`;
    }
    function updateSWDisplay() {
        let currentTotal = swBaseTime; if (swActive) currentTotal += (Date.now() - swStartTime);
        document.getElementById('sw-display').innerText = formatTime(Math.floor(currentTotal / 1000));
        if(document.body.classList.contains('focus-active')) updateFocusDisplay();
    }
    function saveStudyLog() {
        if (swActive) toggleSW();
        const totalSec = Math.floor(swBaseTime / 1000); if (totalSec <= 0) return;
        const today = new Date().toLocaleDateString('sv-SE');
        let logs = db.get('study_logs', {});
        logs[today] = (logs[today] || 0) + totalSec;
        db.save('study_logs', logs); swBaseTime = 0; db.save('sw_base', 0);
        document.getElementById('sw-display').innerText = "00:00:00";
        document.getElementById('sw-start-btn').innerText = "B·∫ÆT ƒê·∫¶U"; renderStats();
    }

    let tmInterval = null, tmRemaining = 0, tmIsRunning = false;
    function toggleTM() {
        const btn = document.getElementById('tm-start-btn');
        if (!tmIsRunning) {
            if (tmRemaining <= 0) tmRemaining = document.getElementById('tm-min').value * 60;
            tmIsRunning = true; btn.innerText = "D·ª™NG";
            tmInterval = setInterval(() => {
                if (tmRemaining > 0) { tmRemaining--; renderTM(); }
                else { clearInterval(tmInterval); tmIsRunning = false; document.getElementById('alarm-sound').play(); btn.innerText = "CH·∫†Y"; alert("Ho√†n th√†nh phi√™n h·ªçc!"); }
            }, 1000);
        } else { clearInterval(tmInterval); tmIsRunning = false; btn.innerText = "TI·∫æP T·ª§C"; }
    }
    function renderTM() {
        const m = Math.floor(tmRemaining / 60).toString().padStart(2, '0');
        const s = (tmRemaining % 60).toString().padStart(2, '0');
        document.getElementById('tm-display').innerText = `${m}:${s}`;
        if(document.body.classList.contains('focus-active')) updateFocusDisplay();
    }
    function resetTM() { clearInterval(tmInterval); tmIsRunning = false; tmRemaining = document.getElementById('tm-min').value * 60; renderTM(); document.getElementById('tm-start-btn').innerText = "CH·∫†Y"; }

    function renderStats() {
        const logs = db.get('study_logs', {}), body = document.getElementById('stats-body');
        body.innerHTML = '';
        Object.keys(logs).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="label-dim">${date}</td><td class="value-neon">${formatTime(logs[date])}</td>`;
            body.appendChild(tr);
        });
    }

    // --- CALENDAR ---
    let curM = new Date().getMonth(), curY = new Date().getFullYear();
    function drawCal() {
        const marks = db.get('cal_marks', {}), box = document.getElementById('cal-grid'); box.innerHTML = '';
        document.getElementById('cal-title').innerText = `TH√ÅNG ${curM + 1} / ${curY}`;
        const firstDay = new Date(curY, curM, 1).getDay(), daysInMonth = new Date(curY, curM + 1, 0).getDate();
        for (let i = 0; i < firstDay; i++) box.innerHTML += '<div></div>';
        for (let i = 1; i <= daysInMonth; i++) {
            const key = `${curY}-${curM + 1}-${i}`, dayEl = document.createElement('div');
            dayEl.className = 'cal-day'; dayEl.innerText = i;
            dayEl.style = `font-size:0.7rem; aspect-ratio:1; display:grid; place-items:center; cursor:pointer; border-radius:6px; background:${marks[key] ? 'var(--neon-pink)' : 'rgba(255,255,255,0.05)'}`;
            dayEl.onclick = () => { marks[key] = !marks[key]; db.save('cal_marks', marks); drawCal(); };
            box.appendChild(dayEl);
        }
    }
    function changeMonth(v) { curM += v; if (curM < 0) { curM = 11; curY--; } if (curM > 11) { curM = 0; curY++; } drawCal(); }

    // --- MISSIONS ---
    let todos = db.get('todos', []);
    function addTodo() {
        const input = document.getElementById('todo-input');
        if (input.value) { todos.push({ txt: input.value, done: false }); input.value = ''; renderTodos(); }
    }
    function renderTodos() {
        const list = document.getElementById('todo-list'); list.innerHTML = '';
        todos.forEach((t, i) => {
            const d = document.createElement('div'); d.className = `todo-item ${t.done ? 'done' : ''}`;
            d.innerHTML = `<span style="flex:1">${t.txt}</span><small onclick="deleteTodo(event, ${i})">‚úï</small>`;
            d.onclick = () => { todos[i].done = !todos[i].done; renderTodos(); }; list.appendChild(d);
        });
        db.save('todos', todos);
    }
    function deleteTodo(e, i) { e.stopPropagation(); todos.splice(i, 1); renderTodos(); }

    // --- ROADMAP (FIXED) ---
    const roadmapData = ["T∆∞ duy ƒë·ªãnh l∆∞·ª£ng", "T∆∞ duy ƒë·ªãnh t√≠nh", "Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ", "T·ªïng √¥n L√Ω 11-12", "C·∫•u tr√∫c d·ªØ li·ªáu", "L·∫≠p tr√¨nh C++/Python", "ƒê·ªÅ luy·ªán HSA 01", "ƒê·ªÅ luy·ªán HSA 02", "T·ªëi ∆∞u h√≥a ƒëi·ªÉm s·ªë", "Chi·∫øn thu·∫≠t ph√≤ng thi"];
    function renderRoadmap() {
        const roadMarks = db.get('road_marks', {});
        const roadBox = document.getElementById('roadmap-list');
        roadBox.innerHTML = '';
        roadmapData.forEach((task, index) => {
            const item = document.createElement('div');
            item.className = `todo-item ${roadMarks[index] ? 'done' : ''}`;
            item.innerHTML = `<span style="font-size:0.65rem">B${index+1}: ${task}</span>`;
            item.onclick = () => {
                roadMarks[index] = !roadMarks[index];
                db.save('road_marks', roadMarks);
                renderRoadmap();
            };
            roadBox.appendChild(item);
        });
    }

    // --- FOCUS MODE ---
    function toggleFocus(on) {
        const b = document.getElementById('main-body');
        if (on) { b.classList.add('focus-active'); updateFocusDisplay(); } else b.classList.remove('focus-active');
    }
    function updateFocusDisplay() {
        const big = document.getElementById('focus-timer-big'), lbl = document.getElementById('focus-mode-label');
        if (tmIsRunning) {
            const m = Math.floor(tmRemaining / 60).toString().padStart(2, '0'), s = (tmRemaining % 60).toString().padStart(2, '0');
            big.innerText = `${m}:${s}`; lbl.innerText = "POMODORO RUNNING";
        } else {
            let cur = swBaseTime; if (swActive) cur += (Date.now() - swStartTime);
            big.innerText = formatTime(Math.floor(cur / 1000)); lbl.innerText = "DEEP WORK MODE";
        }
    }

    // --- INITIALIZE ---
    function init() {
        setInterval(() => {
            const n = new Date();
            document.getElementById('sys-date').innerText = n.toLocaleDateString('vi-VN', { weekday: 'long', year: 'numeric', month: 'long', day: '2-digit' }).toUpperCase();
            document.getElementById('main-clock').innerText = n.toLocaleTimeString('vi-VN', { hour12: false });
        }, 1000);

        const n = new Date();
        document.getElementById('tn-d-center').innerText = Math.max(0, Math.ceil((new Date("2026-06-11") - n) / 86400000));
        document.getElementById('hsa-d-center').innerText = Math.max(0, Math.ceil((new Date("2026-04-05") - n) / 86400000));

        ['hsa', 'math', 'physics', 'it'].forEach(id => {
            const el = document.getElementById('target-' + id);
            if(el) { el.value = db.get('target_' + id, el.value); el.oninput = () => db.save('target_' + id, el.value); }
        });

        document.getElementById('tactical-search').onkeypress = (e) => {
            if (e.key === 'Enter') {
                const q = e.target.value.trim();
                if (q) window.open(q.includes('.') ? (q.startsWith('http') ? q : 'https://' + q) : 'https://google.com/search?q=' + q, '_blank');
                e.target.value = '';
            }
        };

        renderTodos(); drawCal(); renderStats(); updateSWDisplay(); updateVideo(); renderRoadmap();
        document.getElementById('scratchpad').value = db.get('scratch', '');
        document.getElementById('scratchpad').oninput = (e) => db.save('scratch', e.target.value);
        document.getElementById('quote-display').innerText = db.get('quote', 'K·ª∂ LU·∫¨T L√Ä S·ª®C M·∫†NH');

        const subjects = ["To√°n H·ªçc", "V·∫≠t L√Ω", "H√≥a H·ªçc", "Tin H·ªçc", "Ng·ªØ VƒÉn", "Ti·∫øng Anh"];
        const subMarks = db.get('sub_marks', {}), subBox = document.getElementById('subject-log');
        subjects.forEach(s => {
            const d = document.createElement('div'); d.className = `todo-item ${subMarks[s] ? 'done' : ''}`;
            d.innerHTML = `<span style="font-size:0.7rem">${s}</span>`;
            d.onclick = () => { subMarks[s] = !subMarks[s]; db.save('sub_marks', subMarks); d.classList.toggle('done'); }; subBox.appendChild(d);
        });
    }

    function adjustZoom(d) {
        let z = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--zoom-level'));
        z = Math.min(Math.max(0.5, z + d), 1.3); document.documentElement.style.setProperty('--zoom-level', z);
    }
    function resetZoom() { document.documentElement.style.setProperty('--zoom-level', 1); }
    function editQuote() { const r = prompt("Ch√¢m ng√¥n m·ªõi:"); if(r) { document.getElementById('quote-display').innerText = r.toUpperCase(); db.save('quote', r.toUpperCase()); } }

    window.addEventListener('keydown', (e) => { if (e.key === "Escape") closeTheater(); });
    init();
</script>
</body>
</html>
